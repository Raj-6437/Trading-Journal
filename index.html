<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trading Journal</title>
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <style>
        :root {
            --primary: #2962ff;
            --primary-dark: #0039cb;
            --secondary: #f5f5f5;
            --text: #212121;
            --text-light: #757575;
            --success: #4caf50;
            --danger: #f44336;
            --warning: #ff9800;
            --background: #ffffff;
            --card-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #fafafa;
            color: var(--text);
        }

        .container {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar Navigation */
        .sidebar {
            width: 250px;
            background: var(--primary);
            color: white;
            padding: 20px 0;
        }

        .sidebar-header {
            padding: 0 20px 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 20px;
        }

        .sidebar-header h2 {
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .nav-item {
            display: flex;
            align-items: center;
            padding: 15px 20px;
            cursor: pointer;
            transition: background 0.3s;
            gap: 15px;
        }

        .nav-item:hover, .nav-item.active {
            background: var(--primary-dark);
        }

        .nav-item i {
            font-size: 1.2rem;
            width: 24px;
            text-align: center;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }

        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 1px solid #e0e0e0;
        }

        .auth-buttons {
            display: flex;
            gap: 10px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
        }

        .btn-outline {
            background: transparent;
            border: 1px solid var(--primary);
            color: var(--primary);
        }

        .btn-outline:hover {
            background: var(--primary);
            color: white;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-danger:hover {
            background: #d32f2f;
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        /* Cards */
        .card {
            background: var(--background);
            border-radius: 8px;
            box-shadow: var(--card-shadow);
            padding: 20px;
            margin-bottom: 20px;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        /* Dashboard Stats */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: var(--card-shadow);
            text-align: center;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            margin: 10px 0;
            color: var(--primary);
        }

        .stat-label {
            color: var(--text-light);
            font-size: 0.9rem;
        }

        /* Forms */
        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .form-input {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary);
        }

        /* Tables */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .data-table th, .data-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        .data-table th {
            background-color: #f5f5f5;
            font-weight: 600;
        }

        .data-table tr:hover {
            background-color: #f9f9f9;
        }

        /* Charts */
        .chart-container {
            height: 300px;
            margin: 20px 0;
            background: #f9f9f9;
            border-radius: 8px;
            display: flex;
            justify-content: center;
            align-items: center;
            color: var(--text-light);
        }

        /* Utility Classes */
        .hidden {
            display: none;
        }

        .text-center {
            text-align: center;
        }

        .mt-20 {
            margin-top: 20px;
        }

        /* Modal */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 8px;
            width: 90%;
            max-width: 500px;
            position: relative;
        }

        .close {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 1.5rem;
            cursor: pointer;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .container {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                height: auto;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Loading Spinner */
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-left: 4px solid var(--primary);
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Journal entries */
        .journal-entry {
            padding: 15px;
            border-bottom: 1px solid #eee;
        }

        .journal-date {
            font-weight: bold;
            color: var(--text-light);
            margin-bottom: 5px;
        }

        .journal-content {
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Sidebar Navigation -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h2><i>üìà</i> Trading Journal</h2>
            </div>
            <div class="nav-item active" data-page="dashboard">
                <i>üìä</i> <span>Dashboard</span>
            </div>
            <div class="nav-item" data-page="trades">
                <i>üíº</i> <span>My Trades</span>
            </div>
            <div class="nav-item" data-page="import">
                <i>üì§</i> <span>Import</span>
            </div>
            <div class="nav-item" data-page="reports">
                <i>üìã</i> <span>Reports</span>
            </div>
            <div class="nav-item" data-page="notes">
                <i>üìù</i> <span>Journal</span>
            </div>
            <div class="nav-item" data-page="settings">
                <i>‚öôÔ∏è</i> <span>Settings</span>
            </div>
            <div class="nav-item" id="logout-btn">
                <i>üö™</i> <span>Logout</span>
            </div>
        </aside>

        <!-- Main Content Area -->
        <main class="main-content">
            <!-- Dashboard Page -->
            <div id="dashboard-page" class="page">
                <div class="page-header">
                    <h1>Dashboard</h1>
                    <div id="auth-buttons" class="auth-buttons">
                        <button class="btn btn-outline" id="login-btn">Login</button>
                        <button class="btn btn-primary" id="signup-btn">Sign Up</button>
                    </div>
                    <div id="user-info" class="hidden">
                        <span>Welcome, <span id="user-name"></span></span>
                    </div>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">Total Profit/Loss</div>
                        <div class="stat-value" id="total-pl">$0.00</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Win Rate</div>
                        <div class="stat-value" id="win-rate">0%</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Total Trades</div>
                        <div class="stat-value" id="total-trades">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Avg. Profit per Trade</div>
                        <div class="stat-value" id="avg-profit">$0.00</div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h2>Performance Chart</h2>
                    </div>
                    <div class="chart-container" id="performance-chart">
                        <p class="text-center">Chart will be displayed here</p>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h2>Recent Trades</h2>
                    </div>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Symbol</th>
                                <th>Type</th>
                                <th>Quantity</th>
                                <th>Price</th>
                                <th>P/L</th>
                            </tr>
                        </thead>
                        <tbody id="recent-trades">
                            <tr>
                                <td colspan="6" class="text-center">No trades yet</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- My Trades Page -->
            <div id="trades-page" class="page hidden">
                <div class="page-header">
                    <h1>My Trades</h1>
                    <button class="btn btn-primary" id="add-trade-btn">Add Trade</button>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h2>Trade List</h2>
                        <div>
                            <input type="text" class="form-input" placeholder="Search trades..." id="trade-search">
                        </div>
                    </div>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Symbol</th>
                                <th>Type</th>
                                <th>Quantity</th>
                                <th>Entry</th>
                                <th>Exit</th>
                                <th>P/L</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="trades-list">
                            <tr>
                                <td colspan="8" class="text-center">No trades yet</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Import Page -->
            <div id="import-page" class="page hidden">
                <div class="page-header">
                    <h1>Import Trades</h1>
                </div>
                <div class="card">
                    <h2>Upload CSV or Excel File</h2>
                    <div class="form-group">
                        <label class="form-label" for="file-upload">Select File</label>
                        <input type="file" id="file-upload" accept=".csv,.xlsx,.xls">
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="file-format">File Format</label>
                        <select class="form-input" id="file-format">
                            <option value="csv">CSV</option>
                            <option value="excel">Excel</option>
                        </select>
                    </div>
                    <button class="btn btn-primary" id="import-btn">Import Trades</button>
                </div>
            </div>

            <!-- Reports Page -->
            <div id="reports-page" class="page hidden">
                <div class="page-header">
                    <h1>Reports</h1>
                </div>
                <div class="card">
                    <h2>Generate Reports</h2>
                    <div class="form-group">
                        <label class="form-label" for="report-type">Report Type</label>
                        <select class="form-input" id="report-type">
                            <option value="performance">Performance Report</option>
                            <option value="trades">Trades Report</option>
                            <option value="monthly">Monthly Summary</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="date-range">Date Range</label>
                        <select class="form-input" id="date-range">
                            <option value="all">All Time</option>
                            <option value="month">This Month</option>
                            <option value="quarter">This Quarter</option>
                            <option value="year">This Year</option>
                            <option value="custom">Custom Range</option>
                        </select>
                    </div>
                    <div class="form-group" id="custom-date-range" style="display: none;">
                        <label class="form-label">Custom Range</label>
                        <div style="display: flex; gap: 10px;">
                            <input type="date" class="form-input" id="start-date">
                            <input type="date" class="form-input" id="end-date">
                        </div>
                    </div>
                    <div style="display: flex; gap: 10px;">
                        <button class="btn btn-primary" id="generate-pdf">Download PDF</button>
                        <button class="btn btn-success" id="generate-excel">Download Excel</button>
                    </div>
                </div>
            </div>

            <!-- Notes Page -->
            <div id="notes-page" class="page hidden">
                <div class="page-header">
                    <h1>Trading Journal</h1>
                    <button class="btn btn-primary" id="add-note-btn">Add Entry</button>
                </div>
                <div class="card">
                    <h2>My Journal Entries</h2>
                    <div id="journal-entries">
                        <p class="text-center">No journal entries yet</p>
                    </div>
                </div>
            </div>

            <!-- Settings Page -->
            <div id="settings-page" class="page hidden">
                <div class="page-header">
                    <h1>Settings</h1>
                </div>
                <div class="card">
                    <h2>Profile Settings</h2>
                    <form id="profile-form">
                        <div class="form-group">
                            <label class="form-label" for="display-name">Display Name</label>
                            <input type="text" class="form-input" id="display-name">
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="email">Email</label>
                            <input type="email" class="form-input" id="email" disabled>
                        </div>
                        <button type="submit" class="btn btn-primary">Save Changes</button>
                    </form>
                </div>
                <div class="card">
                    <h2>Preferences</h2>
                    <div class="form-group">
                        <label class="form-label" for="currency">Currency</label>
                        <select class="form-input" id="currency">
                            <option value="USD">USD ($)</option>
                            <option value="EUR">EUR (‚Ç¨)</option>
                            <option value="GBP">GBP (¬£)</option>
                            <option value="JPY">JPY (¬•)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="date-format">Date Format</label>
                        <select class="form-input" id="date-format">
                            <option value="mm/dd/yyyy">MM/DD/YYYY</option>
                            <option value="dd/mm/yyyy">DD/MM/YYYY</option>
                            <option value="yyyy-mm-dd">YYYY-MM-DD</option>
                        </select>
                    </div>
                    <button class="btn btn-primary" id="save-preferences">Save Preferences</button>
                </div>
            </div>

            <!-- Auth Modal -->
            <div id="auth-modal" class="modal hidden">
                <div class="modal-content">
                    <span class="close">&times;</span>
                    <h2 id="auth-modal-title">Login</h2>
                    <form id="auth-form">
                        <div class="form-group" id="name-field" style="display: none;">
                            <label class="form-label" for="name">Full Name</label>
                            <input type="text" class="form-input" id="name" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="auth-email">Email</label>
                            <input type="email" class="form-input" id="auth-email" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="auth-password">Password</label>
                            <input type="password" class="form-input" id="auth-password" required>
                        </div>
                        <button type="submit" class="btn btn-primary" id="auth-submit-btn">Login</button>
                    </form>
                    <div class="text-center mt-20">
                        <p>Or</p>
                        <button class="btn btn-outline" id="google-auth-btn">Sign in with Google</button>
                    </div>
                    <p class="text-center mt-20" id="auth-switch-text">
                        Don't have an account? <a href="#" id="auth-switch-btn">Sign up</a>
                    </p>
                </div>
            </div>

            <!-- Add/Edit Trade Modal -->
            <div id="trade-modal" class="modal hidden">
                <div class="modal-content">
                    <span class="close">&times;</span>
                    <h2 id="trade-modal-title">Add Trade</h2>
                    <form id="trade-form">
                        <input type="hidden" id="trade-id">
                        <div class="form-group">
                            <label class="form-label" for="trade-symbol">Symbol</label>
                            <input type="text" class="form-input" id="trade-symbol" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="trade-type">Type</label>
                            <select class="form-input" id="trade-type" required>
                                <option value="buy">Buy</option>
                                <option value="sell">Sell</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="trade-quantity">Quantity</label>
                            <input type="number" class="form-input" id="trade-quantity" required min="1">
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="trade-entry">Entry Price</label>
                            <input type="number" class="form-input" id="trade-entry" required step="0.01" min="0">
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="trade-exit">Exit Price</label>
                            <input type="number" class="form-input" id="trade-exit" step="0.01" min="0">
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="trade-date">Date</label>
                            <input type="date" class="form-input" id="trade-date" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="trade-notes">Notes</label>
                            <textarea class="form-input" id="trade-notes" rows="3"></textarea>
                        </div>
                        <button type="submit" class="btn btn-primary">Save Trade</button>
                    </form>
                </div>
            </div>

            <!-- Add Journal Entry Modal -->
            <div id="journal-modal" class="modal hidden">
                <div class="modal-content">
                    <span class="close">&times;</span>
                    <h2 id="journal-modal-title">Add Journal Entry</h2>
                    <form id="journal-form">
                        <input type="hidden" id="journal-id">
                        <div class="form-group">
                            <label class="form-label" for="journal-title">Title</label>
                            <input type="text" class="form-input" id="journal-title" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="journal-content">Content</label>
                            <textarea class="form-input" id="journal-content" rows="6" required></textarea>
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="journal-date">Date</label>
                            <input type="date" class="form-input" id="journal-date" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="journal-mood">Mood</label>
                            <select class="form-input" id="journal-mood">
                                <option value="üòä">Happy</option>
                                <option value="üòê">Neutral</option>
                                <option value="üòî">Sad</option>
                                <option value="üò†">Frustrated</option>
                                <option value="üòÉ">Excited</option>
                                <option value="üò∞">Anxious</option>
                            </select>
                        </div>
                        <button type="submit" class="btn btn-primary">Save Entry</button>
                    </form>
                </div>
            </div>
        </main>
    </div>

    <script>
        // Firebase configuration - replace with your actual config
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "your-project.firebaseapp.com",
            projectId: "your-project-id",
            storageBucket: "your-project.appspot.com",
            messagingSenderId: "123456789",
            appId: "YOUR_APP_ID"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // DOM Elements
        const pages = document.querySelectorAll('.page');
        const navItems = document.querySelectorAll('.nav-item');
        const authButtons = document.getElementById('auth-buttons');
        const userInfo = document.getElementById('user-info');
        const userName = document.getElementById('user-name');
        const loginBtn = document.getElementById('login-btn');
        const signupBtn = document.getElementById('signup-btn');
        const logoutBtn = document.getElementById('logout-btn');
        const authModal = document.getElementById('auth-modal');
        const authModalTitle = document.getElementById('auth-modal-title');
        const authForm = document.getElementById('auth-form');
        const authSubmitBtn = document.getElementById('auth-submit-btn');
        const authSwitchBtn = document.getElementById('auth-switch-btn');
        const authSwitchText = document.getElementById('auth-switch-text');
        const nameField = document.getElementById('name-field');
        const googleAuthBtn = document.getElementById('google-auth-btn');
        const closeModalButtons = document.querySelectorAll('.close');
        const tradeModal = document.getElementById('trade-modal');
        const tradeForm = document.getElementById('trade-form');
        const addTradeBtn = document.getElementById('add-trade-btn');
        const tradesList = document.getElementById('trades-list');
        const addNoteBtn = document.getElementById('add-note-btn');
        const journalModal = document.getElementById('journal-modal');
        const journalForm = document.getElementById('journal-form');
        const journalEntries = document.getElementById('journal-entries');
        const dateRange = document.getElementById('date-range');
        const customDateRange = document.getElementById('custom-date-range');

        // State variables
        let isLoginMode = true;

        // Navigation
        navItems.forEach(item => {
            if (item.id !== 'logout-btn') {
                item.addEventListener('click', () => {
                    const pageId = item.getAttribute('data-page') + '-page';
                    
                    // Update active nav item
                    navItems.forEach(navItem => navItem.classList.remove('active'));
                    item.classList.add('active');
                    
                    // Show selected page
                    pages.forEach(page => page.classList.add('hidden'));
                    document.getElementById(pageId).classList.remove('hidden');
                });
            }
        });

        // Date range toggle
        dateRange.addEventListener('change', () => {
            customDateRange.style.display = dateRange.value === 'custom' ? 'block' : 'none';
        });

        // Authentication state observer
        auth.onAuthStateChanged(user => {
            if (user) {
                // User is signed in
                authButtons.classList.add('hidden');
                userInfo.classList.remove('hidden');
                userName.textContent = user.displayName || user.email;
                
                // Load user data
                loadUserData();
                loadJournalEntries();
            } else {
                // User is signed out
                authButtons.classList.remove('hidden');
                userInfo.classList.add('hidden');
                
                // Clear user data from UI
                clearUserData();
            }
        });

        // Auth modal handlers
        loginBtn.addEventListener('click', () => {
            showAuthModal(true);
        });

        signupBtn.addEventListener('click', () => {
            showAuthModal(false);
        });

        function showAuthModal(isLogin) {
            isLoginMode = isLogin;
            authModalTitle.textContent = isLogin ? 'Login' : 'Sign Up';
            authSubmitBtn.textContent = isLogin ? 'Login' : 'Sign Up';
            nameField.style.display = isLogin ? 'none' : 'block';
            authSwitchText.innerHTML = isLogin 
                ? 'Don\'t have an account? <a href="#" id="auth-switch-btn">Sign up</a>'
                : 'Already have an account? <a href="#" id="auth-switch-btn">Login</a>';
            authModal.classList.remove('hidden');
            
            // Re-attach event listener for the switch button
            document.getElementById('auth-switch-btn').addEventListener('click', (e) => {
                e.preventDefault();
                showAuthModal(!isLoginMode);
            });
        }

        // Auth form submission
        authForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const email = document.getElementById('auth-email').value;
            const password = document.getElementById('auth-password').value;
            
            if (isLoginMode) {
                // Login
                auth.signInWithEmailAndPassword(email, password)
                    .then(() => {
                        authModal.classList.add('hidden');
                        authForm.reset();
                    })
                    .catch(error => {
                        alert('Login error: ' + error.message);
                    });
            } else {
                // Sign up
                const name = document.getElementById('name').value;
                auth.createUserWithEmailAndPassword(email, password)
                    .then((userCredential) => {
                        // Update user profile
                        return userCredential.user.updateProfile({
                            displayName: name
                        });
                    })
                    .then(() => {
                        authModal.classList.add('hidden');
                        authForm.reset();
                    })
                    .catch(error => {
                        alert('Sign up error: ' + error.message);
                    });
            }
        });

        // Google authentication
        googleAuthBtn.addEventListener('click', () => {
            const provider = new firebase.auth.GoogleAuthProvider();
            auth.signInWithPopup(provider)
                .then(() => {
                    authModal.classList.add('hidden');
                })
                .catch(error => {
                    alert('Google auth error: ' + error.message);
                });
        });

        // Logout
        logoutBtn.addEventListener('click', () => {
            auth.signOut()
                .then(() => {
                    // Signed out successfully
                })
                .catch(error => {
                    alert('Logout error: ' + error.message);
                });
        });

        // Close modals
        closeModalButtons.forEach(btn => {
            btn.addEventListener('click', () => {
                authModal.classList.add('hidden');
                tradeModal.classList.add('hidden');
                journalModal.classList.add('hidden');
            });
        });

        // Trade modal
        addTradeBtn.addEventListener('click', () => {
            document.getElementById('trade-modal-title').textContent = 'Add Trade';
            tradeForm.reset();
            document.getElementById('trade-id').value = '';
            document.getElementById('trade-date').valueAsDate = new Date();
            tradeModal.classList.remove('hidden');
        });

        // Trade form submission
        tradeForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const tradeId = document.getElementById('trade-id').value;
            const tradeData = {
                symbol: document.getElementById('trade-symbol').value,
                type: document.getElementById('trade-type').value,
                quantity: parseInt(document.getElementById('trade-quantity').value),
                entryPrice: parseFloat(document.getElementById('trade-entry').value),
                exitPrice: document.getElementById('trade-exit').value ? 
                    parseFloat(document.getElementById('trade-exit').value) : null,
                date: document.getElementById('trade-date').value,
                notes: document.getElementById('trade-notes').value,
                createdAt: firebase.firestore.FieldValue.serverTimestamp()
            };

            // Calculate P/L if exit price exists
            if (tradeData.exitPrice) {
                const multiplier = tradeData.type === 'buy' ? 1 : -1;
                tradeData.profitLoss = multiplier * tradeData.quantity * 
                    (tradeData.exitPrice - tradeData.entryPrice);
            }

            const user = auth.currentUser;
            if (user) {
                if (tradeId) {
                    // Update existing trade
                    db.collection('users').doc(user.uid).collection('trades').doc(tradeId)
                        .update(tradeData)
                        .then(() => {
                            tradeModal.classList.add('hidden');
                        })
                        .catch(error => {
                            alert('Error updating trade: ' + error.message);
                        });
                } else {
                    // Add new trade
                    db.collection('users').doc(user.uid).collection('trades')
                        .add(tradeData)
                        .then(() => {
                            tradeModal.classList.add('hidden');
                        })
                        .catch(error => {
                            alert('Error adding trade: ' + error.message);
                        });
                }
            }
        });

        // Journal modal
        addNoteBtn.addEventListener('click', () => {
            document.getElementById('journal-modal-title').textContent = 'Add Journal Entry';
            journalForm.reset();
            document.getElementById('journal-id').value = '';
            document.getElementById('journal-date').valueAsDate = new Date();
            journalModal.classList.remove('hidden');
        });

        // Journal form submission
        journalForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const journalId = document.getElementById('journal-id').value;
            const journalData = {
                title: document.getElementById('journal-title').value,
                content: document.getElementById('journal-content').value,
                date: document.getElementById('journal-date').value,
                mood: document.getElementById('journal-mood').value,
                createdAt: firebase.firestore.FieldValue.serverTimestamp()
            };

            const user = auth.currentUser;
            if (user) {
                if (journalId) {
                    // Update existing journal entry
                    db.collection('users').doc(user.uid).collection('journal').doc(journalId)
                        .update(journalData)
                        .then(() => {
                            journalModal.classList.add('hidden');
                        })
                        .catch(error => {
                            alert('Error updating journal entry: ' + error.message);
                        });
                } else {
                    // Add new journal entry
                    db.collection('users').doc(user.uid).collection('journal')
                        .add(journalData)
                        .then(() => {
                            journalModal.classList.add('hidden');
                        })
                        .catch(error => {
                            alert('Error adding journal entry: ' + error.message);
                        });
                }
            }
        });

        // Load user data from Firestore
        function loadUserData() {
            const user = auth.currentUser;
            if (user) {
                // Load trades
                db.collection('users').doc(user.uid).collection('trades')
                    .orderBy('date', 'desc')
                    .onSnapshot(snapshot => {
                        tradesList.innerHTML = '';
                        let totalPL = 0;
                        let winCount = 0;
                        let totalTrades = 0;
                        
                        snapshot.forEach(doc => {
                            const trade = doc.data();
                            const tradeId = doc.id;
                            totalTrades++;
                            
                            // Calculate statistics
                            if (trade.profitLoss !== undefined) {
                                totalPL += trade.profitLoss;
                                if (trade.profitLoss > 0) winCount++;
                            }
                            
                            // Add to trades list
                            const tr = document.createElement('tr');
                            tr.innerHTML = `
                                <td>${formatDate(trade.date)}</td>
                                <td>${trade.symbol}</td>
                                <td>${trade.type}</td>
                                <td>${trade.quantity}</td>
                                <td>${trade.entryPrice.toFixed(2)}</td>
                                <td>${trade.exitPrice ? trade.exitPrice.toFixed(2) : '-'}</td>
                                <td>${trade.profitLoss !== undefined ? '$' + trade.profitLoss.toFixed(2) : '-'}</td>
                                <td>
                                    <button class="btn btn-outline edit-trade" data-id="${tradeId}">Edit</button>
                                    <button class="btn btn-danger delete-trade" data-id="${tradeId}">Delete</button>
                                </td>
                            `;
                            tradesList.appendChild(tr);
                        });
                        
                        if (snapshot.empty) {
                            tradesList.innerHTML = '<tr><td colspan="8" class="text-center">No trades yet</td></tr>';
                        }
                        
                        // Update statistics
                        document.getElementById('total-pl').textContent = '$' + totalPL.toFixed(2);
                        document.getElementById('win-rate').textContent = totalTrades > 0 ? 
                            ((winCount / totalTrades) * 100).toFixed(2) + '%' : '0%';
                        document.getElementById('total-trades').textContent = totalTrades;
                        document.getElementById('avg-profit').textContent = totalTrades > 0 ? 
                            '$' + (totalPL / totalTrades).toFixed(2) : '$0.00';
                        
                        // Add event listeners to edit and delete buttons
                        document.querySelectorAll('.edit-trade').forEach(btn => {
                            btn.addEventListener('click', () => editTrade(btn.getAttribute('data-id')));
                        });
                        
                        document.querySelectorAll('.delete-trade').forEach(btn => {
                            btn.addEventListener('click', () => deleteTrade(btn.getAttribute('data-id')));
                        });
                    });
            }
        }

        // Load journal entries
        function loadJournalEntries() {
            const user = auth.currentUser;
            if (user) {
                db.collection('users').doc(user.uid).collection('journal')
                    .orderBy('date', 'desc')
                    .onSnapshot(snapshot => {
                        journalEntries.innerHTML = '';
                        
                        if (snapshot.empty) {
                            journalEntries.innerHTML = '<p class="text-center">No journal entries yet</p>';
                            return;
                        }
                        
                        snapshot.forEach(doc => {
                            const entry = doc.data();
                            const entryId = doc.id;
                            
                            const entryEl = document.createElement('div');
                            entryEl.className = 'journal-entry';
                            entryEl.innerHTML = `
                                <div class="journal-date">${formatDate(entry.date)} ${entry.mood || ''}</div>
                                <h3 class="journal-title">${entry.title}</h3>
                                <div class="journal-content">${entry.content}</div>
                                <div>
                                    <button class="btn btn-outline edit-journal" data-id="${entryId}">Edit</button>
                                    <button class="btn btn-danger delete-journal" data-id="${entryId}">Delete</button>
                                </div>
                            `;
                            journalEntries.appendChild(entryEl);
                        });
                        
                        // Add event listeners to edit and delete buttons
                        document.querySelectorAll('.edit-journal').forEach(btn => {
                            btn.addEventListener('click', () => editJournal(btn.getAttribute('data-id')));
                        });
                        
                        document.querySelectorAll('.delete-journal').forEach(btn => {
                            btn.addEventListener('click', () => deleteJournal(btn.getAttribute('data-id')));
                        });
                    });
            }
        }

        // Clear user data from UI
        function clearUserData() {
            tradesList.innerHTML = '<tr><td colspan="8" class="text-center">No trades yet</td></tr>';
            journalEntries.innerHTML = '<p class="text-center">No journal entries yet</p>';
            document.getElementById('total-pl').textContent = '$0.00';
            document.getElementById('win-rate').textContent = '0%';
            document.getElementById('total-trades').textContent = '0';
            document.getElementById('avg-profit').textContent = '$0.00';
        }

        // Edit trade
        function editTrade(tradeId) {
            const user = auth.currentUser;
            if (user) {
                db.collection('users').doc(user.uid).collection('trades').doc(tradeId).get()
                    .then(doc => {
                        if (doc.exists) {
                            const trade = doc.data();
                            document.getElementById('trade-modal-title').textContent = 'Edit Trade';
                            document.getElementById('trade-id').value = tradeId;
                            document.getElementById('trade-symbol').value = trade.symbol;
                            document.getElementById('trade-type').value = trade.type;
                            document.getElementById('trade-quantity').value = trade.quantity;
                            document.getElementById('trade-entry').value = trade.entryPrice;
                            document.getElementById('trade-exit').value = trade.exitPrice || '';
                            document.getElementById('trade-date').value = trade.date;
                            document.getElementById('trade-notes').value = trade.notes || '';
                            tradeModal.classList.remove('hidden');
                        }
                    })
                    .catch(error => {
                        alert('Error loading trade: ' + error.message);
                    });
            }
        }

        // Edit journal entry
        function editJournal(journalId) {
            const user = auth.currentUser;
            if (user) {
                db.collection('users').doc(user.uid).collection('journal').doc(journalId).get()
                    .then(doc => {
                        if (doc.exists) {
                            const entry = doc.data();
                            document.getElementById('journal-modal-title').textContent = 'Edit Journal Entry';
                            document.getElementById('journal-id').value = journalId;
                            document.getElementById('journal-title').value = entry.title;
                            document.getElementById('journal-content').value = entry.content;
                            document.getElementById('journal-date').value = entry.date;
                            document.getElementById('journal-mood').value = entry.mood || 'üòê';
                            journalModal.classList.remove('hidden');
                        }
                    })
                    .catch(error => {
                        alert('Error loading journal entry: ' + error.message);
                    });
            }
        }

        // Delete trade
        function deleteTrade(tradeId) {
            if (confirm('Are you sure you want to delete this trade?')) {
                const user = auth.currentUser;
                if (user) {
                    db.collection('users').doc(user.uid).collection('trades').doc(tradeId).delete()
                        .catch(error => {
                            alert('Error deleting trade: ' + error.message);
                        });
                }
            }
        }

        // Delete journal entry
        function deleteJournal(journalId) {
            if (confirm('Are you sure you want to delete this journal entry?')) {
                const user = auth.currentUser;
                if (user) {
                    db.collection('users').doc(user.uid).collection('journal').doc(journalId).delete()
                        .catch(error => {
                            alert('Error deleting journal entry: ' + error.message);
                        });
                }
            }
        }

        // Format date for display
        function formatDate(dateString) {
            const options = { year: 'numeric', month: 'short', day: 'numeric' };
            return new Date(dateString).toLocaleDateString(undefined, options);
        }

        // Initialize the app
        function initApp() {
            // Set current date as default for new trades and journal entries
            document.getElementById('trade-date').valueAsDate = new Date();
            document.getElementById('journal-date').valueAsDate = new Date();
        }

        // Run initialization when DOM is loaded
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>